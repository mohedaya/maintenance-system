<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maintenance System</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}
h1 {
    margin-bottom: 10px;
}
.section {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 15px;
}
.task {
    margin-left: 20px;
    padding: 5px 0;
}
input[type="number"] {
    width: 60px;
}
button {
    padding: 6px 12px;
    margin-top: 10px;
}
</style>
</head>

<body>

<h1>Maintenance Dashboard</h1>

<div class="section">
    <label>Select Inspection:</label>
    <select id="inspectionSelect"></select>
    <button onclick="loadWorkPackage()">Load Work Package</button>
</div>

<div class="section">
    <h3>Tasks</h3>
    <div id="tasks"></div>
</div>

<div class="section">
    <strong>Total Man-Hours:</strong>
    <span id="totalMH">0</span>
</div>

<script>
let libraryData = null;
fetch("library/inspection_library.json")
.then(res => {
    if (!res.ok) throw new Error("Library fetch failed");
    return res.json();
})
.then(data => {
    libraryData = data;
    const select = document.getElementById("inspectionSelect");
    Object.keys(data.inspections).forEach(key => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = key;
        select.appendChild(opt);
    });
})
.catch(err => alert("Library error: " + err.message));

function loadWorkPackage() {
    if (!libraryData) {
        alert("Library not loaded yet");
        return;
    }

    const insp = document.getElementById("inspectionSelect").value;
    const tasksDiv = document.getElementById("tasks");
    tasksDiv.innerHTML = "";
    document.getElementById("totalMH").textContent = "0";

    const sections = libraryData.inspections[insp];

    Object.keys(sections).forEach(sectionName => {
        const sectionTitle = document.createElement("h4");
        sectionTitle.textContent = sectionName;
        tasksDiv.appendChild(sectionTitle);

        sections[sectionName].forEach(task => {
            const div = document.createElement("div");
            div.className = "task";

            div.innerHTML = `
                <strong>${task.id}</strong> â€” ${task.title}
                <br>
                MH:
                <input type="number" min="0" step="0.1" value="0"
                       onchange="updateTotal()">
                <label>
                    <input type="checkbox"> Done
                </label>
            `;
            tasksDiv.appendChild(div);
        });
    });
}

function updateTotal() {
    let total = 0;
    document.querySelectorAll('input[type="number"]').forEach(i => {
        total += Number(i.value) || 0;
    });
    document.getElementById("totalMH").textContent = total.toFixed(1);
}
</script>

</body>
</html>
