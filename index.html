<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maintenance Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .section {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .task {
      margin-left: 20px;
    }
    .task input {
      width: 60px;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<h1>Maintenance Dashboard</h1>

<div class="section">
  <label for="inspectionSelect"><strong>Select Inspection:</strong></label>
  <select id="inspectionSelect">
    <option value="100_HRS">100 HRS</option>
    <option value="300_HRS">300 HRS</option>
    <option value="600_HRS">600 HRS</option>
  </select>
  <button id="loadBtn">Load Work Package</button>
</div>

<div class="section">
  <h3>Tasks</h3>
  <div id="tasks">No tasks loaded</div>
</div>

<div class="section">
  <strong>Total Man-Hours:</strong>
  <span id="totalMH">0</span>
</div>

<script>
let libraryData = null;

// ===== LOAD LIBRARY =====
fetch("library/inspection_library.json")
  .then(res => {
    if (!res.ok) throw new Error("Library fetch failed");
    return res.json();
  })
  .then(data => {
    libraryData = data;
    console.log("Library loaded OK");
  })
  .catch(err => {
    alert("Dashboard error: " + err.message);
  });

// ===== BUTTON =====
document.getElementById("loadBtn").addEventListener("click", () => {
  if (!libraryData) {
    alert("Library not loaded yet");
    return;
  }
  const inspKey = document.getElementById("inspectionSelect").value;
  renderTasks(inspKey);
});

// ===== RENDER TASKS =====
function renderTasks(inspectionKey) {
  const container = document.getElementById("tasks");
  container.innerHTML = "";
  let totalMH = 0;

  const inspection = libraryData.inspections[inspectionKey];
  if (!inspection) {
    container.innerHTML = "Inspection not found";
    return;
  }

  for (const sectionName in inspection.sections) {
    const sectionDiv = document.createElement("div");
    sectionDiv.innerHTML = `<h4>${sectionName} (${inspectionKey})</h4>`;

    inspection.sections[sectionName].forEach(task => {
      const taskDiv = document.createElement("div");
      taskDiv.className = "task";

      taskDiv.innerHTML = `
        <label>
          ${task.task_id} - ${task.title}
          <input type="number" min="0" step="0.1" value="0">
        </label>
      `;

      const input = taskDiv.querySelector("input");
      input.addEventListener("input", () => {
        calculateTotal();
      });

      sectionDiv.appendChild(taskDiv);
    });

    container.appendChild(sectionDiv);
  }

  calculateTotal();
}

// ===== TOTAL MH =====
function calculateTotal() {
  let sum = 0;
  document.querySelectorAll(".task input").forEach(i => {
    sum += Number(i.value) || 0;
  });
  document.getElementById("totalMH").textContent = sum.toFixed(1);
}
</script>

</body>
</html>
